const soBoSungPDF = {
    so_1: ` <li>
        <strong>Chỉ số thiếu 1</strong>
        <ul>
            <li>Thiếu tính tự chủ, thiếu tính quyết liệt, thiếu khả năng lãnh đạo</li>
            <li>Khá cô đơn, đơn độc</li>
            <li>Thiếu khả năng quyết đoán, thụ động → họ cần những người cố vấn, người tham vấn</li>
            <li>Thiếu là họ có năng lực đấy nhưng họ cần hoàn thiện năng lực đó, giống như là cần hoàn thành bài thi để tốt nghiệp năng lực đó</li>
        </ul>
        <strong>Giải pháp:</strong>
        <ul>
            <li>Làm những công việc mà đi chuẩn năng lượng</li>
            <li>Đặt những mục tiêu để vượt qua vùng an toàn</li>
            <li>Thiếu số 1 thì tìm cho mình người cố vấn để tránh đi sai đường</li>
        </ul>
    </li>`,
    so_2: `  <li>
        <strong>Chỉ số thiếu 2</strong>
        <ul>
            <li>Không giỏi phân tích vấn đề</li>
            <li>Hay tin người và dễ bị lừa về tình cảm</li>
            <li>Thiếu lắng nghe thiếu kết nối</li>
            <li>Hay bị tổn thương những vấn đề liên quan đến tình cảm trong gia đình</li>
        </ul>
        <strong>Giải pháp:</strong>
        <ul>
            <li>Chủ động kết nối, chủ động trao đi yêu thương, dám nói lên quan điểm chính kiến của mình,</li>
            <li>Học cách nhạy cảm hơn với nhu cầu và thái độ của người khác</li>
        </ul>
    </li>`,
    so_3: `   <li>
        <strong>Chỉ số thiếu 3</strong>
        <ul>
            <li>Thiếu kỹ năng giao tiếp, năng lượng thấp</li>
            <li>Ăn nói kém</li>
            <li>Hay bị cảm xúc chi phối</li>
            <li>Khả năng diễn đạt kém</li>
        </ul>
        <strong>Giải pháp:</strong>
        <ul>
            <li>Đọc nhiều sách để tích luỹ về ngôn từ, giao tiếp với nhiều người hoạt ngôn và tìm cho mình môi trường năng lượng cao và tích cực</li>
        </ul>
    </li>`,
    so_4: `  <li>
        <strong>Chỉ số thiếu 4</strong>
        <ul>
            <li>Thiếu tính thực tế, thiếu kỷ luật, thiếu sự kiên trì</li>
            <li>Không bám đuổi mục tiêu đến cùng</li>
            <li>Làm việc không có quy trình, không có kế hoạch</li>
        </ul>
        <strong>Giải pháp:</strong>
        <ul>
            <li>Cần có time line check list để bám vào, cần đưa mình vào môi trường có tính kỷ luật và mục tiêu.</li>
            <li>  Môi trường rất quan trọng, có đất thì mới dụng võ được.</li>
        </ul>
    </li>`,
    so_5: `    <li>
        <strong>Chỉ số thiếu 5</strong>
        <ul>
            <li>Thiếu tính quyết liệt, sợ thay đổi, không dám đương đầu với thách thức</li>
            <li>Thiếu sáng tạo, thiếu linh hoạt, né tránh khó khăn nên họ sẽ nhạt nhoà, tẻ nhạt</li>
        </ul>
        <strong>Giải pháp:</strong>
        <ul>
            <li>Tìm được đam mê, biết sở thích là gì để cho mình cơ hộ trải nghiệm, khám phá cái mới, sẵn sàng đương đầu với thử thách rủi ro.</li>
            <li> Tham gia vào cộng đồng tích cực để phát triển bản thân, môi trường Tam Bảo.</li>
        </ul>
    </li>`,
    so_6: `  <li>
        <strong>Chỉ số thiếu 6</strong>
        <ul>
            <li>Là những người thiếu sự đồng cảm, quan tâm đến người khác, dễ trở lên ích kỷ, lạnh lùng</li>
            <li>Tuổi thơ dễ thiếu thốn tình cảm do thiếu thốn tình cảm của bố mẹ (tuổi thơ)</li>
            <li>Với người ngoài thì mình nói yêu thương nhưng người thân thì khó nói → hãy khai thác để khách hàng nói nhiều về họ</li>
        </ul>
        <strong>Giải pháp:</strong>
        <ul>
            <li>Hãy làm tròn vai trò của họ trong gia đình, trong xã hội hãy cho đi yêu thương.</li>
            <li> Những người thành công Họ cần trải qua được 3 loại nước: Gáo nước lạnh đổ lên đầu mình, mồ hôi và nước mắt</li>
        </ul>
    </li>`,
    so_7: `  <li>
        <strong>Chỉ số thiếu 7</strong>
        <ul>
            <li>Thiếu khả năng tự học, thiếu ấm áp, hay nghi ngờ</li>
        </ul>
        <strong>Giải pháp:</strong>
        <ul>
            <li>Học phát triển bản thân liên tục, cần đọc nhiều sách, cần có sự tĩnh lặng để chiêm nghiệm bản thân, chiêm nghiệm cuộc đời, </li>
            <li>Học cách quan sát phân tích và đúc kết mọi thứ</li>
        </ul>
    </li>`,
    so_8: `    <li>
        <strong>Chỉ số thiếu 8</strong>
        <ul>
            <li>Thiếu khả năng tổ chức, ghi nhớ kém, tham vọng</li>
            <li>Thiếu kiến thức về tài chính và đầu tư</li>
        </ul>
        <strong>Giải pháp:</strong>
        <ul>
            <li> Học kiến thức liên quan đến tài chính và đầu tư. Học cách chi tiết thực tế hơn và cần có người cố vấn</li>
        </ul>
    </li>`,
    so_9: `  <li>
        <strong>Chỉ số thiếu 9</strong>
        <ul>
            <li>Thiếu khát vọng lớn, thiếu tính mạo hiểm, thiếu suy nghĩ cho người khác</li>
        </ul>
        <strong>Giải pháp:</strong>
        <ul>
            <li>Học cách cho đi, tìm cho mình 1 cái lý tưởng, và khát vọng giúp đỡ được nhiều người</li>
        </ul>
    </li>`
}
const soDamMePDF = {
    so_1: `<div>
    <p><strong>Số 1:</strong> Bạn độc lập, mạnh mẽ, luôn đưa ra những ý tưởng độc đáo. 
    Bạn giỏi tập trung để hoàn thành nhiệm vụ, nên thường đạt được nhiều thành tựu đáng kể.</p>
</div>`,
    so_2: `<div>
    <p><strong>Số 2:</strong> Bạn rất hợp tác và hòa hợp với những người khác. 
    Ngoài ra bạn có khả năng giảng hòa các cuộc tranh cãi, nên mọi người luôn lắng nghe tiếng nói của bạn.</p>
</div>`,
    so_3: `<div>
    <p><strong>Số 3:</strong> Bạn hòa đồng và thích giải trí, nên dù ở đâu bạn cũng pha trò và thu hút mọi người.
     Bạn tài năng và luôn cống hiến hết mình cho công việc.</p>
</div>`,
    so_4: `<div>
    <p><strong>Số 4:</strong> Bạn có tính kỷ luật cao và theo 1 lịch trình nhất định.
     Bạn kiên trì và luôn nỗ lực hết sức để hoàn thành công việc 1 cách cẩn thận.</p>
</div>`,
    so_5: `<div>
    <p><strong>Số 5:</strong> Bạn dễ dàng thích nghi với mọi thay đổi, hay thường đi du lịch để trải nghiệm và khám phá.
     Khả năng ngôn ngữ linh hoạt giúp bạn thu hút người khác.</p>
</div>`,
    so_6: `<div>
    <p><strong>Số 6:</strong> Bạn linh hoạt và dễ dàng thích nghi với các tình huống. 
    Bạn có một trái tim hòa đồng, nhân hậu, quan tâm đến mọi người xung quanh,
     nên luôn suy nghĩ tìm cách giúp đỡ những người kém may mắn.</p>
</div>`,
    so_7: `<div>
    <p><strong>Số 7:</strong> Bạn luôn bình ổn, trí tuệ phát triển và trực giác cao. 
    Bạn thích cân nhắc và tìm hiểu những thứ xung quanh nên bạn có kiến thức rất sâu sắc.</p>
</div>`,
    so_8: `<div>
    <p><strong>Số 8:</strong> Bạn có động lực mạnh mẽ để hoàn thành công việc hoặc kế hoạch nhằm đảm bảo tiền bạc và địa vị.</p>
</div>`,
    so_9: `<div>
    <p><strong>Số 9:</strong> Bạn có thể là người yêu thích âm nhạc hoặc nghệ thuật, với xu hướng thay đổi giữa các thái cực cảm xúc.
     Bạn quan tâm đến việc giúp đỡ người khác và giải cứu thế giới hơn bản thân mình.</p>
</div>`,
}


function tinhToanSo() {
    const str = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

    let ten = removeAccent(document.getElementById("fullName").value.trim().toUpperCase());
    let ngaySinh = document.getElementById("birthDay").value.trim();
    if (ngaySinh.length !== 10) {
        alert("Ngày sinh không hợp lệ!")
        return
    }

    let arrNa = [];
    let arrPa = [];
    let daySoCamXuc = [];
    let daySoTrucGiac = [];
    const arrNgaySinh = extractNumbers(ngaySinh);
    const arr = convertNameToNumbers(ten, str);
    const so_ngaySinh = getSumOnly([arrNgaySinh[0], arrNgaySinh[1]]);
    const so_thangSinh = getSumOnly([arrNgaySinh[2], arrNgaySinh[3]]);
    const so_namSinh = getSumOnly([arrNgaySinh[4], arrNgaySinh[5], arrNgaySinh[6], arrNgaySinh[7]]);

    nguyenPhuAm(ten); // Lấy ra mảng nguyên âm và phụ âm
    getDaySoCamXuc(ten); //Lấy ra mảng chữ số cảm xúc trong tên
    getDaySoTrucGiac(ten);  // Lấy ra mảng chữ số trực giác trong tên

    let duongDoiSlide = getSum(arrNgaySinh);
    document.getElementById("duongDoi").innerHTML = duongDoiSlide;
    document.getElementById("duongDoi-P").innerHTML = duongDoiSlide;

    let suMenhSlide = getSum(arr);
    document.getElementById("suMenh").innerHTML = suMenhSlide;
    document.getElementById("suMenh-P").innerHTML = suMenhSlide;

    let linhHonSlide = getSum(arrNa);
    document.getElementById("linhHon").innerHTML = linhHonSlide;
    document.getElementById("linhHon-P").innerHTML = linhHonSlide;

    let nhanCachSlide = getSumOnly(arrPa);
    document.getElementById("nhanCach").innerHTML = nhanCachSlide;
    document.getElementById("nhanCach-P").innerHTML = nhanCachSlide;

    let canBangSlide = getSumOnly(convertNameToNumbers(getInitials(ten), str));
    document.getElementById("canBang").innerHTML = canBangSlide;
    document.getElementById("canBang-P").innerHTML = canBangSlide;

    let truongThanhSlide = getSum([...arrNgaySinh, ...arr]);
    document.getElementById("truongThanh").innerHTML = truongThanhSlide;
    document.getElementById("truongThanh-P").innerHTML = truongThanhSlide;

    let ngaySinh1Slide = getBirthDayNumber(arrNgaySinh);
    document.getElementById("ngaySinh").innerHTML = ngaySinh1Slide;
    document.getElementById("ngaySinh-P").innerHTML = ngaySinh1Slide;

    let thaiDoSlide = getAttitudeNumber(arrNgaySinh);
    document.getElementById("thaiDo").innerHTML = thaiDoSlide;
    document.getElementById("thaiDo-P").innerHTML = thaiDoSlide;

    let tuDuyLyTriSlide = (getBirthDayNumber(arrNgaySinh) + getDestinyNumber(getLastWordNumbers(ten, str))) % 9 || 9;
    document.getElementById("tuDuyLyTri").innerHTML = tuDuyLyTriSlide;
    document.getElementById("tuDuyLyTri-P").innerHTML = tuDuyLyTriSlide;

    let vanMenhSlide = getDestinyNumber(getLastWordNumbers(ten, str));
    document.getElementById("vanMenh").innerHTML = vanMenhSlide;
    document.getElementById("vanMenh-P").innerHTML = vanMenhSlide;

    let soThieuSlide = getMissingNumbers(arr);
    document.getElementById("soThieu").innerHTML = soThieuSlide;
    document.getElementById("soThieu-P").innerHTML = soThieuSlide;

    let sucManhTiemThucSlide = 9 - getMissingNumbers(arr).length;
    document.getElementById("sucManhTiemThuc").innerHTML = sucManhTiemThucSlide;
    document.getElementById("sucManhTiemThuc-P").innerHTML = sucManhTiemThucSlide;

    let soCamXucSlide = getSumOnly(daySoCamXuc);
    document.getElementById("soCamXuc").innerHTML = soCamXucSlide;
    document.getElementById("soCamXuc-P").innerHTML = soCamXucSlide;

    let soTrucGiacSlide = getSumOnly(daySoTrucGiac);
    document.getElementById("soTrucGiac").innerHTML = soTrucGiacSlide;
    document.getElementById("soTrucGiac-P").innerHTML = soTrucGiacSlide;

    let namCaNhanSlide = namCaNhanHienTai();
    document.getElementById("namCaNhan").innerHTML = namCaNhanSlide;
    document.getElementById("namCaNhan-P").innerHTML = namCaNhanSlide;

    let thangCaNhanSlide = thangCaNhan(namCaNhanHienTai());
    document.getElementById("thangCaNhan").innerHTML = thangCaNhanSlide;
    document.getElementById("thangCaNhan-P").innerHTML = thangCaNhanSlide;

    let ketNoiVanMenhSlide = (Math.abs(getSum(arrNgaySinh) - getSum(arr))) % 9 || 9;
    document.getElementById("ketNoiVanMenh").innerHTML = ketNoiVanMenhSlide;
    document.getElementById("ketNoiVanMenh-P").innerHTML = ketNoiVanMenhSlide;

    let soDamMeSlide = getDaySoDamMe(arr);
    document.getElementById("soDamMe").innerHTML = soDamMeSlide;
    document.getElementById("soDamMe-P").innerHTML = soDamMeSlide;

    let soKetNoiLinhHonSlide = (Math.abs(getSum(arrNgaySinh) - getSum(arrNa))) % 9 || 9;
    document.getElementById("soKetNoiLinhHon").innerHTML = soKetNoiLinhHonSlide;
    document.getElementById("soKetNoiLinhHon-P").innerHTML = soKetNoiLinhHonSlide;

    let soTuDuyTraiNghiemSlide = getSoTuDuyTraiNghiem(ten);
    document.getElementById("soTuDuyTraiNghiem").innerHTML = soTuDuyTraiNghiemSlide;
    document.getElementById("soTuDuyTraiNghiem-P").innerHTML = soTuDuyTraiNghiemSlide;

    let dinhCao1 = document.getElementById("s_tuoichang1_1").innerHTML = getSumOnly([so_ngaySinh, so_thangSinh]);
    let dinhCao2 = document.getElementById("s_tuoichang2_1").innerHTML = getSumOnly([so_ngaySinh, so_namSinh]);
    let dinhCao3 = document.getElementById("s_tuoichang3_1").innerHTML = getSumOnly([dinhCao1, dinhCao2]);
    let dinhCao4 = document.getElementById("s_tuoichang4_1").innerHTML = getSumOnly([so_thangSinh, so_namSinh]);

    let thachThuc1 = document.getElementById("s_sothachthuc1_2").innerHTML = (Math.abs(so_ngaySinh - so_thangSinh)) % 9;
    let thachThuc2 = document.getElementById("s_sothachthuc2_2").innerHTML = (Math.abs(so_ngaySinh - so_namSinh)) % 9;
    let thachThuc3 = document.getElementById("s_sothachthuc3_3").innerHTML = Math.abs(thachThuc1 - thachThuc2);
    let thachThuc4 = document.getElementById("s_sothachthuc4_4").innerHTML = Math.abs(so_thangSinh - so_namSinh);

    // $("#showFullName").text(ten);
    $("#showSoDinhCao").append(dinhCao1 + " - " + dinhCao2 + " - " + dinhCao3 + " - " + dinhCao4);
    $("#showSoThachThuc").append(thachThuc1 + " - " + thachThuc2 + " - " + thachThuc3 + " - " + thachThuc4);

    getIndexNumberByName(arr)
    getIndexNumberByBirthDay(arrNgaySinh)

    if (localStorage.getItem("loggedInUser") === "admin") {
        document.getElementById("show_so_thieu").innerHTML = soThieuSlide;
        for (let i = 0; i < soThieuSlide.length; i++) {
            let numberTarget = "so_" + soThieuSlide[i];
            document.getElementById("show_so_thieu").innerHTML += soBoSungPDF[numberTarget];
        }
        document.getElementById("show_so_dam_me").innerHTML = soDamMeSlide;
        for (let i = 0; i < soDamMeSlide.length; i++) {
            let numberTarget = "so_" + soDamMeSlide[i];
            document.getElementById("show_noi_dung_so_dam_me").innerHTML += soDamMePDF[numberTarget];
        }

        document.getElementById("showFullName").innerHTML = ten + " - " + ngaySinh;
        const dataPDF = {
            duongDoi: duongDoiSlide,
            suMenh: suMenhSlide,
            linhHon: linhHonSlide,
            nhanCach: nhanCachSlide,
            canBang: canBangSlide,
            truongThanh: truongThanhSlide,
            ngaySinh: ngaySinh1Slide,
            thaiDo: thaiDoSlide,
            tuDuyLyTri: tuDuyLyTriSlide,
            vanMenh: vanMenhSlide,
            soThieu: soThieuSlide,
            sucManhTiemThuc: sucManhTiemThucSlide,
            soCamXuc: soCamXucSlide,
            soTrucGiac: soTrucGiacSlide,
            namCaNhan: namCaNhanSlide,
            thangCaNhan: thangCaNhanSlide,
            ketNoiVanMenh: ketNoiVanMenhSlide,
            soDamMe: soDamMeSlide,
            soKetNoiLinhHon: soKetNoiLinhHonSlide,
            soTuDuyTraiNghiem: soTuDuyTraiNghiemSlide
        }
        generatePDFWithImages1(dataPDF, ten).then(r => {
            alert("Tải file thành công!")
        })
    }


    function extractNumbers(value) {
        return (value.match(/[0-9]/g) || []).map(Number);
    }

    function convertNameToNumbers(name) {
        return [...name].filter(c => c !== ' ').map(c => (str.indexOf(c) % 9) + 1);
    }

    function getMissingNumbers(arr) {
        return [1, 2, 3, 4, 5, 6, 7, 8, 9].filter(n => !arr.includes(n));
    }

    // Lay chữ cái đầu trong họ và tên
    function getInitials(name) {
        return name.split(' ').map(word => word[0]).join('');
    }

    // Chữ số trong tên
    function getLastWordNumbers(name, str) {
        const lastWord = name.split(' ').pop();
        return convertNameToNumbers(lastWord, str).filter(n => n !== 0);
    }

    function getSumOnly(arr) {
        return arr.reduce((acc, curr) => (acc + curr) % 9, 0) || 9;
    }

    function getSum(arr) {
        const sum = arr.reduce((acc, curr) => acc + curr, 0);
        if (sum === 11 || sum === 22 || sum === 33) return sum;
        return (sum % 9) || 9;
    }

    function getBirthDayNumber(arr) {
        return (arr[0] + arr[1]) % 9 || 9;
    }

    function getAttitudeNumber(arr) {
        return getSumOnly(arr.slice(0, arr.length - 4));
    }

    function getDestinyNumber(arr) {
        return getSum(arr);
    }

    function nguyenPhuAm(name) {
        const abc = name.replace(/\s/g, '');
        for (let i = 0; i < abc.length; i++) {
            if (abc[i] === "A" || abc[i] === "E" || abc[i] === "I" || abc[i] === "O" || abc[i] === "U") {
                arrNa.push(str.indexOf(abc[i]) % 9 + 1);
            } else {
                arrPa.push(str.indexOf(abc[i]) % 9 + 1);
            }
        }
    }

    function getDaySoCamXuc(name) {
        const abc = name.replace(/\s/g, '');
        for (let i = 0; i < abc.length; i++) {
            if (abc[i] === "I" || abc[i] === "O" || abc[i] === "R" || abc[i] === "Z" || abc[i] === "B" || abc[i] === "S" || abc[i] === "T" || abc[i] === "X") {
                daySoCamXuc.push(str.indexOf(abc[i]) % 9 + 1);
            }
        }
    }

    function getDaySoTrucGiac(name) {
        const abc = name.replace(/\s/g, '');
        for (let i = 0; i < abc.length; i++) {
            if (abc[i] === "K" || abc[i] === "F" || abc[i] === "Q" || abc[i] === "U" || abc[i] === "Y" || abc[i] === "C" || abc[i] === "V") {
                daySoTrucGiac.push(str.indexOf(abc[i]) % 9 + 1);
            }
        }
    }

    function getSoTuDuyTraiNghiem(name) {
        const abc = name.replace(/\s/g, '');
        let soTuDuyTraiNghiem = [];
        for (let i = 0; i < abc.length; i++) {
            if (abc[i] === "E" || abc[i] === "W" || abc[i] === "D" || abc[i] === "M") {
                soTuDuyTraiNghiem.push(str.indexOf(abc[i]) % 9 + 1);
            }
        }
        if (soTuDuyTraiNghiem.length === 0) {
            return 1;
        }
        return getSum(soTuDuyTraiNghiem);
    }

    function layNamHienTai() {
        let currentDate = new Date();
        return currentDate.getFullYear() % 9 || 9;
    }

    function namCaNhanHienTai() {
        return getSumOnly([so_ngaySinh + so_thangSinh, layNamHienTai()])
    }


    function thangCaNhan(namCaNhan) {
        let currentDate = new Date();
        let month = currentDate.getMonth() + 1; // Lưu ý: tháng trong JS bắt đầu từ 0
        const monthChars = month.toString().split('');
        const sumOfMonthChars = monthChars.map(char => parseInt(char)).reduce((acc, val) => acc + val, 0);
        return (sumOfMonthChars + namCaNhan) % 9 || 9;
    }

    function getDaySoDamMe(arr) {
        let numCount = {}; // Đếm số lần xuất hiện của từng số
        let maxCount = 0; // Số lần xuất hiện nhiều nhất
        let mostFrequentNumbers = []; // Mảng chứa các số lặp lại nhiều nhất
        for (let num of arr) {
            if (numCount[num]) {
                numCount[num]++;
            } else {
                numCount[num] = 1;
            }
            maxCount = Math.max(maxCount, numCount[num]);
        }

        for (let num in numCount) {
            if (numCount[num] === maxCount) {
                mostFrequentNumbers.push(Number(num)); // Chuyển số về kiểu number (nếu cần)
            }
        }

        return mostFrequentNumbers;
    }

    function removeAccent(string) {
        string = string.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        string = string.replace(/Đ/g, "D").replace(/đ/g, "d");
        return string;
    }

}


function getIndexNumberByName(array) {
    document.getElementById("name_index1").innerHTML = doubleNumber(1, array);
    document.getElementById("name_index2").innerHTML = doubleNumber(2, array);
    document.getElementById("name_index3").innerHTML = doubleNumber(3, array);
    document.getElementById("name_index4").innerHTML = doubleNumber(4, array);
    document.getElementById("name_index5").innerHTML = doubleNumber(5, array);
    document.getElementById("name_index6").innerHTML = doubleNumber(6, array);
    document.getElementById("name_index7").innerHTML = doubleNumber(7, array);
    document.getElementById("name_index8").innerHTML = doubleNumber(8, array);
    document.getElementById("name_index9").innerHTML = doubleNumber(9, array);

    document.getElementById("name_index1_P").innerHTML = doubleNumber(1, array);
    document.getElementById("name_index2_P").innerHTML = doubleNumber(2, array);
    document.getElementById("name_index3_P").innerHTML = doubleNumber(3, array);
    document.getElementById("name_index4_P").innerHTML = doubleNumber(4, array);
    document.getElementById("name_index5_P").innerHTML = doubleNumber(5, array);
    document.getElementById("name_index6_P").innerHTML = doubleNumber(6, array);
    document.getElementById("name_index7_P").innerHTML = doubleNumber(7, array);
    document.getElementById("name_index8_P").innerHTML = doubleNumber(8, array);
    document.getElementById("name_index9_P").innerHTML = doubleNumber(9, array);
}

function getIndexNumberByBirthDay(array) {
    document.getElementById("birthDay_index1").innerHTML = doubleNumber(1, array);
    document.getElementById("birthDay_index2").innerHTML = doubleNumber(2, array);
    document.getElementById("birthDay_index3").innerHTML = doubleNumber(3, array);
    document.getElementById("birthDay_index4").innerHTML = doubleNumber(4, array);
    document.getElementById("birthDay_index5").innerHTML = doubleNumber(5, array);
    document.getElementById("birthDay_index6").innerHTML = doubleNumber(6, array);
    document.getElementById("birthDay_index7").innerHTML = doubleNumber(7, array);
    document.getElementById("birthDay_index8").innerHTML = doubleNumber(8, array);
    document.getElementById("birthDay_index9").innerHTML = doubleNumber(9, array);

    document.getElementById("birthDay_index1_P").innerHTML = doubleNumber(1, array);
    document.getElementById("birthDay_index2_P").innerHTML = doubleNumber(2, array);
    document.getElementById("birthDay_index3_P").innerHTML = doubleNumber(3, array);
    document.getElementById("birthDay_index4_P").innerHTML = doubleNumber(4, array);
    document.getElementById("birthDay_index5_P").innerHTML = doubleNumber(5, array);
    document.getElementById("birthDay_index6_P").innerHTML = doubleNumber(6, array);
    document.getElementById("birthDay_index7_P").innerHTML = doubleNumber(7, array);
    document.getElementById("birthDay_index8_P").innerHTML = doubleNumber(8, array);
    document.getElementById("birthDay_index9_P").innerHTML = doubleNumber(9, array);
}

function doubleNumber(num, array) {
    return array.filter(function (value) {
        return value === num;
    });
}

function xoaDuLieu() {
    location.reload()
}


async function addHtmlContentToPDF(pdf, divId, width, height) {
    const content = document.getElementById(divId);
    const canvasOptions = {
        scale: 6,
        useCORS: true,
        logging: true,
        width: content.offsetWidth,
        height: content.offsetHeight
    };
    const canvas = await html2canvas(content, canvasOptions);
    const imgData = canvas.toDataURL('image/jpeg', 1.0);
    const imgWidth = canvas.width / canvasOptions.scale;
    const imgHeight = canvas.height / canvasOptions.scale;
    const widthRatio = width / imgWidth;
    const heightRatio = height / imgHeight;
    const ratio = Math.min(widthRatio, heightRatio);
    const imgScaledWidth = imgWidth * ratio;
    const imgScaledHeight = imgHeight * ratio;
    const x = (width - imgScaledWidth) / 2;
    const y = (height - imgScaledHeight) / 2;

    pdf.addPage();
    pdf.addImage(imgData, 'JPEG', x, y, imgScaledWidth, imgScaledHeight);
}

async function generatePDFWithImages1(dataPDF, fullName) {
    const button = document.getElementById('tinhToanSo');
    button.classList.add('loading');
    button.textContent = 'Đang tạo file pdf...';
    let pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');

    // Lấy chiều rộng và chiều cao của một trang A4
    let width = pdf.internal.pageSize.getWidth();
    let height = pdf.internal.pageSize.getHeight();

    // Danh sách tên ảnh
    const imageNames = getImageNames(dataPDF);


    try {

        await addHtmlContentToPDF(pdf, 'print_pdf3', width, height);
        pdf.addPage();
        await pdf.deletePage(1);
        for (let [index, imageName] of imageNames.entries()) {

            await addImageToPDF('../img/img_than_so_pdf/' + imageName, index, width, height, pdf, imageNames.length);
            // Thêm trang mới nếu không phải là ảnh cuối cùng
            if (index < imageNames.length - 1) {
                pdf.addPage();
            }
        }
        await addHtmlContentToPDF(pdf, 'print_pdf1', width, height);
        await addHtmlContentToPDF(pdf, 'print_pdf2', width, height);
        pdf.save(`${fullName}.pdf`);
        button.classList.remove('loading');
        button.textContent = 'KHÁM PHÁ BẢN THÂN';
    } catch (error) {
        console.error("Error generating PDF:", error);
    }
}

function getImageNames(dataPDF) {
    let imageNames = [];
    let imgDuongDoi = dataPDF.duongDoi;
    imageNames.push(`so_duong_doi/imgDuongDoi${imgDuongDoi}.jpg`);

    let imgSuMenh = dataPDF.suMenh;
    imageNames.push(`so_su_menh/imgSuMenh${imgSuMenh}.jpg`);

    let imgLinhHon = dataPDF.linhHon;
    imageNames.push(`so_linh_hon/imgLinhHon${imgLinhHon}.jpg`);

    let imgNhanCach = dataPDF.nhanCach;
    imageNames.push(`so_nhan_cach/imgNhanCach${imgNhanCach}.jpg`);

    let imgCanBang = dataPDF.canBang;
    imageNames.push(`so_can_bang/imgCanBang${imgCanBang}.jpg`);

    let imgTruongThanh = dataPDF.truongThanh;
    imageNames.push(`so_truong_thanh/imgTruongThanh${imgTruongThanh}.jpg`);

    let imgNgaySinh = dataPDF.ngaySinh;
    imageNames.push(`so_ngay_sinh/imgSoNgaySinh${imgNgaySinh}.jpg`);

    let imgThaiDo = dataPDF.thaiDo;
    imageNames.push(`so_thai_do/imgThaiDo${imgThaiDo}.jpg`);

    let imgTuDuyLyTri = dataPDF.tuDuyLyTri;
    imageNames.push(`so_tu_duy_ly_tri/imgTuDuyLyTri${imgTuDuyLyTri}.jpg`);

    let imgVanMenh = dataPDF.vanMenh;
    imageNames.push(`so_van_menh/imgVanMenh${imgVanMenh}.jpg`);

    let imgSucManhTiemThuc = dataPDF.sucManhTiemThuc;
    imageNames.push(`so_suc_manh_tiem_thuc/imgSucManhTiemThuc${imgSucManhTiemThuc}.jpg`);

    let imgCamXuc = dataPDF.soCamXuc;
    imageNames.push(`so_cam_xuc/imgCamXuc${imgCamXuc}.jpg`);

    let imgNamCaNhan = dataPDF.namCaNhan;
    imageNames.push(`so_nam_ca_nhan/imgNamCaNhan${imgNamCaNhan}.jpg`);

    let imgThangCaNhan = dataPDF.thangCaNhan;
    imageNames.push(`so_thang_ca_nhan/imgThangCaNhan${imgThangCaNhan}.jpg`);

    let imgKetNoiLinhHon = dataPDF.soKetNoiLinhHon;
    imageNames.push(`so_ket_noi_linh_hon/imgKetNoiLinhHon${imgKetNoiLinhHon}.jpg`);

    return imageNames;
}

// Định nghĩa hàm để thêm ảnh vào PDF
function addImageToPDF(imagePath, index, width, height, pdf, imageNames) {
    return new Promise((resolve, reject) => {
        let img = new Image();
        img.crossOrigin = "Anonymous"; // Thêm dòng này nếu bạn gặp vấn đề với CORS
        img.src = imagePath;
        img.onload = function () {
            try {
                pdf.addImage(img, 'JPEG', 0, 0, width, height);
                if (index < imageNames.length - 1) {
                    pdf.addPage();
                }
                resolve();
            } catch (e) {
                reject(e); // Bắt và phát lại lỗi nếu có
            }
        };
        img.onerror = function () {
            reject(new Error("Error loading image: " + imagePath));
        };
    });
}
